<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¶”ì–µì˜ ìƒì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body { background:#f5f7fb; margin:0; padding:20px; }
    .container { max-width: 900px; margin:auto; }

    .btn {
      padding:10px 18px; border:none; border-radius:30px; cursor:pointer;
      font-weight:600; font-size:14px; color:white; background:#4b6bff;
      margin:4px; box-shadow:0 3px 8px rgba(75,107,255,0.35);
    }
    .btn.secondary { background:#e2e6ff; color:#1c266b; box-shadow:none; }
    .btn.danger { background:#ff4b6b; }

    .card {
      background:white; padding:20px; border-radius:14px;
      margin-bottom:20px; box-shadow:0 5px 16px rgba(0,0,0,0.1);
    }

    .hidden { display:none; }

    input, select {
      padding:7px 10px; border:1px solid #cfd4df; border-radius:8px; width:100%;
      font-size:14px;
    }

    table { width:100%; border-collapse:collapse; font-size:14px; margin-top:10px; }
    th, td { padding:8px; border-bottom:1px solid #e5e7eb; }
    th { background:#f3f4f6; font-weight:600; }

    .bar-row { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .bar-label { width:110px; font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .bar-outer { flex:1; background:#e2e6ff; height:18px; border-radius:10px; overflow:hidden; }
    .bar-inner {
      height:100%; background:#4b6bff; color:white; text-align:right; padding-right:6px;
      font-size:11px; line-height:18px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1 style="text-align:center;">ì¶”ì–µì˜ ìƒì</h1>

  <div style="text-align:center;">
    <button class="btn" onclick="showParticipant()">ì°¸ì—¬ì ëª¨ë“œ</button>
    <button class="btn secondary" onclick="askPassword()">ê´€ë¦¬ì ëª¨ë“œ</button>
  </div>

  <!-- ì°¸ì—¬ì -->
  <div id="participant" class="card hidden"></div>

  <!-- ê´€ë¦¬ì ë¹„ë²ˆ -->
  <div id="passwordBox" class="card hidden">
    <h3>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
    <input id="pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
    <button class="btn" onclick="checkPassword()">í™•ì¸</button>
  </div>

  <!-- ê´€ë¦¬ì -->
  <div id="admin" class="hidden"></div>
</div>

<script>
  const PASSWORD = "YCHS1315";

  const QUESTIONS = [
    "ì²­ì†Œë¥¼ ì—´ì‹¬íˆ í•˜ë˜ ì¹œêµ¬",
    "ë„ì›€ì´ í•„ìš”í•  ë•Œ ê¸°ëŒˆ ìˆ˜ ìˆì—ˆë˜ ì¹œêµ¬",
    "í•™êµ í–‰ì‚¬, ì¼ì • ë“± ì „ë‹¬ ì‚¬í•­ì„ ì˜ ê³µì§€í•´ì£¼ë˜ ì¹œêµ¬",
    "ìˆ˜ì—… ë¶„ìœ„ê¸° ì¡°ì„±ì„ ì˜ ë§ì¶°ì£¼ë˜ ì¹œêµ¬",
    "í˜ë“¤ ë•Œ ì›ƒì„ ìˆ˜ ìˆê²Œ í•´ì£¼ë˜ ì¹œêµ¬",
    "í•™êµ í–‰ì‚¬ì— ì—´ì‹¬íˆ ì°¸ì—¬í•˜ë˜ ì¹œêµ¬",
    "ë¦¬ë”ì‹­, ì¹´ë¦¬ìŠ¤ë§ˆê°€ ë„˜ì¹˜ë˜ ì¹œêµ¬",
    "ë´‰ì‚¬í™œë™ì„ ì—´ì‹¬íˆ í•˜ë˜ ì¹œêµ¬"
  ];

  const SCORE = {1:3, 2:2, 3:1};
  const KEY = "voteData_v5";
  const SUBMIT_KEY = "voteSubmitted_v5";     
  const SUBMIT_COUNT_KEY = "voteSubmitCount_v5";

  function load() {
    const raw = localStorage.getItem(KEY);
    if (!raw) {
      const base = {questions: QUESTIONS.map(()=>({}))};
      localStorage.setItem(KEY, JSON.stringify(base));
      return base;
    }
    return JSON.parse(raw);
  }

  function save(data) {
    localStorage.setItem(KEY, JSON.stringify(data));
  }

  function hideAll() {
    document.getElementById("participant").classList.add("hidden");
    document.getElementById("passwordBox").classList.add("hidden");
    document.getElementById("admin").classList.add("hidden");
  }

  function showParticipant() {
    hideAll();
    const el = document.getElementById("participant");
    el.classList.remove("hidden");

    // ì¤‘ë³µ ì œì¶œ ë°©ì§€
    if (localStorage.getItem(SUBMIT_KEY) === "true") {
      el.innerHTML = `
        <h2>ì°¸ì—¬ì íˆ¬í‘œ</h2>
        <p style="color:#444; font-size:17px; margin-top:15px;">
          ì´ë¯¸ íˆ¬í‘œì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤ ğŸ˜Š
        </p>
      `;
      return;
    }

    el.innerHTML = "<h2>ì°¸ì—¬ì íˆ¬í‘œ</h2>";

    QUESTIONS.forEach((q, i)=>{
      el.innerHTML += `
        <div class="card">
          <h3>${i+1}. ${q}</h3>
          <label>1ìœ„</label><input id="q${i}_1">
          <label>2ìœ„</label><input id="q${i}_2">
          <label>3ìœ„</label><input id="q${i}_3">
        </div>`;
    });

    el.innerHTML += `<button class="btn" onclick="submitVotes()">ì œì¶œí•˜ê¸°</button>`;
  }

  function submitVotes() {
    if (!confirm("ì œì¶œí• ê¹Œìš”? ì´í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

    const data = load();

    // ì ìˆ˜ ëˆ„ì 
    QUESTIONS.forEach((_, qi)=>{
      const seen = new Set();
      for (let r=1; r<=3; r++) {
        const val = document.getElementById(`q${qi}_${r}`).value.trim();
        if (!val) continue;
        if (seen.has(val)) continue;
        seen.add(val);

        if (!data.questions[qi][val]) data.questions[qi][val] = 0;
        data.questions[qi][val] += SCORE[r];
      }
    });

    save(data);

    // â­ ì œì¶œì ìˆ˜ ì¦ê°€
    let c = Number(localStorage.getItem(SUBMIT_COUNT_KEY) || "0");
    localStorage.setItem(SUBMIT_COUNT_KEY, c + 1);

    // â­ ì¤‘ë³µ ì œì¶œ ë°©ì§€
    localStorage.setItem(SUBMIT_KEY, "true");

    alert("ì œì¶œ ì™„ë£Œ!");
    showParticipant();
  }

  function askPassword() {
    hideAll();
    document.getElementById("passwordBox").classList.remove("hidden");
  }

  function checkPassword() {
    const pw = document.getElementById("pw").value;
    if (pw === PASSWORD) showAdmin();
    else alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  }

  function showAdmin() {
    hideAll();
    const el = document.getElementById("admin");
    el.classList.remove("hidden");

    // ì œì¶œ ì¸ì› í‘œì‹œ
    let count = Number(localStorage.getItem(SUBMIT_COUNT_KEY) || "0");

    el.innerHTML = `
      <div class="card">
        <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
        <p style="font-size:16px; margin-bottom:10px;">
          ì´ ì œì¶œ ì¸ì›: <b>${count}</b> ëª…
        </p>
        <button class="btn secondary" onclick="showAdmin()">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn danger" onclick="resetAll()">ì´ˆê¸°í™”</button>
      </div>
    `;

    const data = load();

    // ê·¸ë˜í”„ ì„ íƒ + ì „ì²´ ë³´ê¸°
    el.innerHTML += `
      <div class="card">
        <h3>ê·¸ë˜í”„ ë³´ê¸°</h3>
        <select id="graphSelect">
          <option value="-1">0. ì „ì²´ (ì´ì )</option>
          ${QUESTIONS.map((q,i)=>`<option value="${i}">${i+1}. ${q}</option>`).join("")}
        </select>
        <button class="btn secondary" onclick="drawGraph()">ê·¸ë˜í”„ í‘œì‹œ</button>
        <div id="graphArea" style="margin-top:10px;"></div>
      </div>
    `;

    // í‘œ ì¶œë ¥
    QUESTIONS.forEach((q, qi)=>{
      const entries = Object.entries(data.questions[qi]).sort((a,b)=>b[1]-a[1]);
      let html = `<div class="card"><h3>${qi+1}. ${q}</h3>`;

      if (entries.length === 0) {
        html += "<p>ì•„ì§ ë°ì´í„° ì—†ìŒ</p></div>";
        el.innerHTML += html;
        return;
      }

      html += `
        <table>
          <tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì ìˆ˜</th></tr>
      `;
      
      entries.forEach(([name,score],idx)=>{
        html += `<tr><td>${idx+1}</td><td>${name}</td><td>${score}</td></tr>`;
      });

      html += "</table></div>";
      el.innerHTML += html;
    });
  }

  function drawGraph() {
    const data = load();
    const qIndex = Number(document.getElementById("graphSelect").value);
    const area = document.getElementById("graphArea");
    area.innerHTML = "";

    let entries = [];

    if (qIndex === -1) {
      // ì „ì²´ ì´ì 
      let total = {};
      data.questions.forEach(qObj=>{
        Object.entries(qObj).forEach(([name,score])=>{
          if (!total[name]) total[name] = 0;
          total[name] += score;
        });
      });
      entries = Object.entries(total).sort((a,b)=>b[1]-a[1]);
    } else {
      entries = Object.entries(data.questions[qIndex]).sort((a,b)=>b[1]-a[1]);
    }

    if (entries.length === 0) {
      area.innerHTML = "<p>ë°ì´í„° ì—†ìŒ</p>";
      return;
    }

    const max = entries[0][1];

    entries.forEach(([name,score])=>{
      area.innerHTML += `
        <div class="bar-row">
          <div class="bar-label">${name}</div>
          <div class="bar-outer">
            <div class="bar-inner" style="width:${(score/max)*100}%">${score}</div>
          </div>
        </div>
      `;
    });
  }

  function resetAll() {
    if (!confirm("ì „ì²´ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;

    localStorage.removeItem(KEY);
    localStorage.removeItem(SUBMIT_KEY);
    localStorage.removeItem(SUBMIT_COUNT_KEY);

    showAdmin();
  }
</script>
</body>
</html>
